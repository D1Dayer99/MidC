{"ast":null,"code":"import { CanvasMessages } from \"../../utils/CanvasMessages\";\nimport { PlayingState } from \"../../utils/PlayingState\";\nimport { SET_WORKER, SET_VISUALIZER_DELAY } from \"@/store/consts/mutation_types.js\";\nimport { initCanvas, resizeKeys, startDraw, stopDraw, pauseOrResume, stopSong, changeNoteColors } from \"@/store/consts/actions.js\";\nexport default {\n  namespaced: true,\n  state: {\n    worker: {},\n    visualizerDelay: 0\n  },\n  mutations: {\n    [SET_WORKER](state, worker) {\n      state.worker = worker;\n    },\n    [SET_WATERFALL_DELAY](state, delay) {\n      state.waterfallDelay = delay;\n    }\n  },\n  actions: {\n    [initCanvas]({\n      commit,\n      state\n    }, {\n      offscreenCanvas,\n      visualizer_file\n    }) {\n      commit(SET_WORKER, new Worker(visualizer_file));\n      state.worker.postMessage({\n        canvas: offscreenCanvas,\n        messageType: CanvasMessages.INIT\n      }, [offscreenCanvas]);\n    },\n    [resizeKeys]({\n      commit,\n      state\n    }, {\n      height,\n      width,\n      array,\n      whiteWidth,\n      blackWidth,\n      waterfallDelay\n    }) {\n      let canvasDataIndexesByNote = {};\n      for (let index = 0; index < array.length; index++) {\n        const key = array[index].getAttribute(\"data-note\");\n        const value = Math.floor(array[index].getBoundingClientRect().x);\n        canvasDataIndexesByNote[key] = value;\n      }\n      commit(SET_WATERFALL_DELAY, waterfallDelay);\n      state.worker.postMessage({\n        messageType: CanvasMessages.RESIZE,\n        resizeData: {\n          height: Math.floor(height),\n          width: Math.floor(width),\n          whiteWidth: Math.floor(whiteWidth),\n          blackWidth: Math.floor(blackWidth),\n          array: canvasDataIndexesByNote\n        }\n      });\n    },\n    [startDraw]({\n      state\n    }, drawNote) {\n      state.worker.postMessage({\n        messageType: CanvasMessages.START_DRAW_NOTE,\n        drawNote\n      });\n    },\n    [stopDraw]({\n      state\n    }, drawNote) {\n      state.worker.postMessage({\n        messageType: CanvasMessages.STOP_DRAW_NOTE,\n        drawNote\n      });\n    },\n    [pauseOrResume]({\n      state\n    }, playing) {\n      state.worker.postMessage({\n        messageType: CanvasMessages.PAUSE_SONG,\n        playing\n      });\n    },\n    [stopSong]({\n      state\n    }) {\n      state.worker.postMessage({\n        messageType: CanvasMessages.STOP_SONG,\n        playing: PlayingState.STOP\n      });\n    },\n    [changeNoteColors]({\n      state\n    }, {\n      blackNoteColor,\n      whiteNoteColor\n    }) {\n      state.worker.postMessage({\n        messageType: CanvasMessages.CHANGE_COLOR,\n        colors: {\n          blackNoteColor,\n          whiteNoteColor\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["CanvasMessages","PlayingState","SET_WORKER","SET_VISUALIZER_DELAY","initCanvas","resizeKeys","startDraw","stopDraw","pauseOrResume","stopSong","changeNoteColors","namespaced","state","worker","visualizerDelay","mutations","SET_WATERFALL_DELAY","delay","waterfallDelay","actions","commit","offscreenCanvas","visualizer_file","Worker","postMessage","canvas","messageType","INIT","height","width","array","whiteWidth","blackWidth","canvasDataIndexesByNote","index","length","key","getAttribute","value","Math","floor","getBoundingClientRect","x","RESIZE","resizeData","drawNote","START_DRAW_NOTE","STOP_DRAW_NOTE","playing","PAUSE_SONG","STOP_SONG","STOP","blackNoteColor","whiteNoteColor","CHANGE_COLOR","colors"],"sources":["/Users/Sunhaoxiang/Desktop/IB_CS/CS_IA/src/store/modules/canvasState.js"],"sourcesContent":["import { CanvasMessages } from \"../../utils/CanvasMessages\"\nimport { PlayingState } from \"../../utils/PlayingState\"\nimport { SET_WORKER, SET_VISUALIZER_DELAY } from \"@/store/consts/mutation_types.js\"\nimport { initCanvas, resizeKeys, startDraw, stopDraw, pauseOrResume, stopSong, changeNoteColors } from \"@/store/consts/actions.js\"\n\nexport default {\n    namespaced: true,\n\n    state: {\n      worker: {},\n      visualizerDelay: 0,\n    },\n\n    mutations: {\n        [SET_WORKER](state, worker){\n            state.worker = worker;\n        },\n        [SET_WATERFALL_DELAY](state, delay){\n            state.waterfallDelay = delay;\n        },\n    },\n\n    actions: {\n        [initCanvas]({ commit, state }, { offscreenCanvas, visualizer_file }){\n            commit(SET_WORKER, new Worker(visualizer_file));\n            state.worker.postMessage({ canvas: offscreenCanvas, messageType : CanvasMessages.INIT}, [offscreenCanvas]);\n        },\n\n        [resizeKeys]({ commit, state }, { height, width, array, whiteWidth, blackWidth, waterfallDelay }){\n            let canvasDataIndexesByNote = {}\n            for(let index = 0; index < array.length; index++){\n                const key = array[index].getAttribute(\"data-note\");\n                const value = Math.floor(array[index].getBoundingClientRect().x);\n                canvasDataIndexesByNote[key] = value;\n            }\n  \n            commit(SET_WATERFALL_DELAY, waterfallDelay);\n  \n            state.worker.postMessage({ \n                messageType : CanvasMessages.RESIZE, \n                resizeData : {\n                    height: Math.floor(height), \n                    width: Math.floor(width), \n                    whiteWidth : Math.floor(whiteWidth), \n                    blackWidth: Math.floor(blackWidth), \n                    array : canvasDataIndexesByNote \n                }\n            });\n        },\n\n        [startDraw]({state}, drawNote){\n            state.worker.postMessage({ messageType : CanvasMessages.START_DRAW_NOTE, drawNote });\n        },\n\n        [stopDraw]({state}, drawNote){\n            state.worker.postMessage({ messageType : CanvasMessages.STOP_DRAW_NOTE, drawNote });\n        },\n\n        [pauseOrResume]({state}, playing){\n            state.worker.postMessage({ messageType : CanvasMessages.PAUSE_SONG, playing });\n        },\n\n        [stopSong]({state}){\n            state.worker.postMessage({ messageType : CanvasMessages.STOP_SONG, playing : PlayingState.STOP });\n        },\n\n        [changeNoteColors]({state}, { blackNoteColor, whiteNoteColor }){\n            state.worker.postMessage({ messageType : CanvasMessages.CHANGE_COLOR, colors : { blackNoteColor, whiteNoteColor }});\n        }\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}